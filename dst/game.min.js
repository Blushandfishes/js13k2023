function e(){for(this.ui=[],ms=[[-32,H.HAM],[-116,H.SWD],[52,H.AX]],i=0;i<ms.length;i++)this.ui.push(new J(16,16,V/2+ms[i][0],Z-88,0,H.UI,"",4,!0)),this.ui.push(new J(10,10,V/2+ms[i][0]+14,Z-80,0,ms[i][1],"",4,!0));for(i=0;i<5;i++)this.ui.push(new J(16,16,20+32*i,0,0,H.HP,"",4,!0));this.ui.push(new J(6,16,212,0,0,H.HPE,"",4,!0)),m=new J(6,16,0,0,0,H.HPE,"",4,!0),m.flip=!0,this.ui.push(m)}var h,n=!1,a=!1,o={songData:[{i:[2,96,128,0,2,8,164,0,0,5,12,44,43,0,0,0,0,69,3,1,1,26,116,0,32,0,6,76,6],p:[1,3,1,4,5,6,7,8],c:[{n:[147,,,,,,,,150,,,,,,,,149,,,,,,150,149,147,,,,,,145],f:[]},{n:[],f:[]},{n:[147,,,,,,145,147,149,,,,,,147,145,147],f:[]},{n:[147,,,,,,145,147,149,,,,,,150,152,154,,,,,,,,153],f:[]},{n:[154,,,,,,,,157,,,,,,156,157,159,,,,,,,,154,,,,,,152],f:[]},{n:[154,,,,,,,,157,,,,,,156,157,159,,,,,,,,,,,,,,161],f:[]},{n:[162,,,,,,,,,,,,,,161,162,164,,,,,,,,,,,,,,161,164],f:[]},{n:[166,,,,,,,,,,,,,,,173,173],f:[]}]},{i:[3,61,128,0,3,63,128,0,0,9,17,40,72,0,0,0,1,178,7,0,2,255,15,0,32,83,8,84,8],p:[11,12,11,14,13,13,15,16],c:[{n:[],f:[]},{n:[147,,,,147,,,,147,,,,147,,,,147,,,,147,,,,147,,,,147],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[135,,,,,,,,,,,,,,,,135,,,,,,,,,,,,,,,,138,,,,,,,,,,,,,,,,140,,,,,,,,,,,,,,,,142,,,,,,,,,,,,,,,,144],f:[]},{n:[131,,,,,,,,133,,,,,,,,135,,,,,,,,,,,,,,,,135,,,,,,,,137,,,,,,,,139,,,,,,,,,,,,,,,,138,,,,,,,,140,,,,,,,,142],f:[]},{n:[142,,,,,,,,,,,,,,,,142,,,,,,,,,,,,,,,,145,,,,,,,,,,,,,,,,147,,,,,,,,,,,,,,,,149,,,,,,,,,,,,,,,,151],f:[]},{n:[131,,,,,,,,133,,,,,,,,138,,,,,,,,137,,,,,,,,135,,,,,,,,137,,,,,,,,142,,,,,,,,141,,,,,,,,138,,,,,,,,140,,,,,,,,145,,,,,,,,144],f:[]},{n:[138,,,,,,,,,,,,,,,,140,,,,,,,,,,,,,,,,142,,,,,,,,,,,,,,,,144,,,,,,,,,,,,,,,,145,,,,,,,,,,,,,,,,147],f:[]},{n:[142,,,,,,,,,,,,,,,,142,,,,,,,,,,,,,,,,147,,,,,,,,,,,,,,,,146,,,,,,,,,,,,,,,,149,,,,,,,,,,,,,,,,149],f:[]}]},{i:[1,0,128,0,1,0,128,9,0,37,13,5,20,0,0,0,0,0,0,0,2,255,0,0,32,47,3,0,1],p:[17,17,17,17,17,17,17,17],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[147,,147,147,147,,147,147,147,,147,147,147,,147,147,147,,147,147,147,,147,147,147,,147,147,147,,147,147],f:[]}]},{i:[0,99,116,79,0,53,116,0,83,0,4,6,69,52,0,0,0,0,0,0,2,14,0,0,32,0,0,0,0],p:[18,18,18,18,18,18,18,18],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[135,,,,135,,,,137,,,,135,,,,135,,,,135,,,,135,,,,135],f:[]}]},{i:[2,83,128,0,3,182,128,0,0,0,0,6,29,0,0,0,0,0,0,0,3,5,184,119,244,147,6,0,0],p:[19,20,19,21,22,22,23,24],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[111,,111,111,111,,111,111,111,,111,111,111,,111,,104,,104,104,104,,104,104,104,,104,104,104,,106],f:[]},{n:[107,,107,107,107,,107,107,109,,109,109,109,,109,109,111,,111,111,111,,111,111,111,,111,111,111,,111],f:[]},{n:[107,,107,107,107,,107,107,109,,109,109,109,,109,109,114,,114,114,114,,114,114,113,,113,113,113,114,115,116],f:[]},{n:[118,,118,118,118,,118,118,118,,118,118,118,,118,,111,,111,111,111,,111,111,111,,111,111,111,113,114,116],f:[]},{n:[114,,114,114,114,,114,114,114,,114,114,114,,114,114,116,,116,116,116,,116,116,116,,116,116,116,,116],f:[]},{n:[118,,118,118,118,,118,118,118,,118,118,118,,113,,118,,118,118,118,,118,118,118,,118,118,118,116,114,113],f:[]}]}],rowLen:4562,patternLen:32,endPattern:7,numChannels:5},l=function(){var t,e,i,s,h,n=function(t){return Math.sin(6.283184*t)},a=function(t){return.003959503758*2**((t-128)/12)},o=function(t,e,i){var s,h,n,o,c,l,f=r[t.i[0]],u=t.i[1],y=t.i[3]/32,p=r[t.i[4]],x=t.i[5],d=t.i[8]/32,v=t.i[9],m=t.i[10]*t.i[10]*4,w=t.i[11]*t.i[11]*4,b=t.i[12]*t.i[12]*4,g=1/b,k=-t.i[13]/16,M=t.i[14],S=i*2**(2-t.i[15]),E=new Int32Array(m+w+b),T=0,A=0;for(s=0,h=0;s<m+w+b;s++,h++)h>=0&&(h-=S,c=a(e+(15&(M=M>>8|(255&M)<<4))+t.i[2]-128),l=a(e+(15&M)+t.i[6]-128)*(1+8e-4*t.i[7])),n=1,s<m?n=s/m:s>=m+w&&(n=(1-(n=(s-m-w)*g))*3**(k*n)),o=f(T+=c*n**y)*u,o+=p(A+=l*n**d)*x,v&&(o+=(2*Math.random()-1)*v),E[s]=80*o*n|0;return E},r=[n,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var e=t%1*4;return e<2?e-1:3-e}];this.init=function(n){t=n,e=n.endPattern,i=0,s=n.rowLen*n.patternLen*(e+1)*2,h=new Int32Array(s)},this.generate=function(){var a,c,l,f,u,y,p,x,d,v,m,w,b,g,k=new Int32Array(s),M=t.songData[i],S=t.rowLen,E=t.patternLen,T=0,A=0,R=!1,H=[];for(l=0;l<=e;++l)for(p=M.p[l],f=0;f<E;++f){var C=p?M.c[p-1].f[f]:0;C&&(M.i[C-1]=M.c[p-1].f[f+E]||0,C<17&&(H=[]));var D=r[M.i[16]],P=M.i[17]/512,I=2**(M.i[18]-9)/S,W=M.i[19],z=M.i[20],L=43.23529*M.i[21]*3.141592/44100,j=1-M.i[22]/255,B=1e-5*M.i[23],N=M.i[24]/32,O=M.i[25]/512,Y=6.283184*2**(M.i[26]-9)/S,G=M.i[27]/255,F=M.i[28]*S&-2;for(m=(l*E+f)*S,u=0;u<4;++u)if(y=p?M.c[p-1].n[f+u*E]:0){H[y]||(H[y]=o(M,y,S));var U=H[y];for(c=0,a=2*m;c<U.length;c++,a+=2)k[a]+=U[c]}for(c=0;c<S;c++)(v=k[x=2*(m+c)])||R?(w=L,W&&(w*=D(I*x)*P+.5),A+=(w=1.5*Math.sin(w))*(b=j*(v-A)-(T+=w*A)),v=3==z?A:1==z?b:T,B&&(v=(v*=B)<1?v>-1?n(.25*v):-1:1,v/=B),R=(v*=N)*v>1e-5,g=v*(1-(d=Math.sin(Y*x)*O+.5)),v*=d):g=0,x>=F&&(g+=k[x-F+1]*G,v+=k[x-F]*G),k[x]=0|g,k[x+1]=0|v,h[x]+=0|g,h[x+1]+=0|v}return++i/t.numChannels},this.createAudioBuffer=function(t){for(var e=t.createBuffer(2,s/2,44100),i=0;i<2;i++)for(var n=e.getChannelData(i),a=i;a<s;a+=2)n[a>>1]=h[a]/65536;return e},this.createWave=function(){var t=44+2*s-8,e=t-36,i=new Uint8Array(44+2*s);i.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&e,e>>8&255,e>>16&255,e>>24&255]);for(var n=0,a=44;n<s;++n){var o=h[n];o=o<-32767?-32767:o>32767?32767:o,i[a++]=255&o,i[a++]=o>>8&255}return i},this.getData=function(t,e){for(var i=2*Math.floor(44100*t),s=new Array(e),n=0;n<2*e;n+=1){var a=i+n;s[n]=t>0&&a<h.length?h[a]/32768:0}return s}},u;function y(){var t=new l;t.init(o),setInterval(function(){if(!n&&(n=t.generate()>=1)){var e=t.createWave();(h=document.createElement("audio")).src=URL.createObjectURL(new Blob([e],{type:"audio/wav"})),a=!0}},0)}function p(t,e,i,s,h,n,a,o=It){this.time=0,this.x=i,this.y=s,this.w=t,this.h=e,this.type=n,this.endPos=U(this),this.speed=7,this.angle=Math.atan2(this.endPos.y-this.y,this.endPos.x-this.x),this.remove=!1,this.alpha=1,this.colour="#"+["FF0000","B30000","7D0000","FF8080"][j(0,3)],this.no=1,"dust"==this.type&&(this.colour="#"+["4d1933","EDEDED"][j(0,1)],this.alpha=.1),this.rndCol=a,this.lastDir=o,this.update=function(t,e){if(this.time+=e,t.save(),t.translate(pt.cam.x,pt.cam.y),"circle"==this.type){let e=Math.atan2(this.y-this.endPos.y,this.x-this.endPos.x)+Math.PI+2*(Math.random()-.5);Math.hypot(this.endPos.x-this.x,this.endPos.y-this.y)>=10&&(this.x+=Math.cos(e)*this.speed-6*this.time,this.y+=Math.sin(e)*this.speed-6*this.time),this.alpha-=.01,this.w>1&&(this.w-=.75),t.beginPath(),t.globalAlpha=this.alpha,t.arc(this.x,this.y,this.w,0,6.283185307179586);let i=this.rndCol?L():this.colour;t.fillStyle=i,t.fill(),this.time>.6&&(this.remove=!0)}else"dust"==this.type&&(this.lastDir==It?this.x-=2:this.x+=2,this.y-=j(1,5)/10,t.beginPath(),t.globalAlpha=this.alpha,t.arc(this.x,this.y,this.w,0,6.283185307179586),t.fillStyle=this.colour,t.fill(),this.alpha>.1&&(this.alpha-=.01),this.w+=.1,this.time>.5&&(this.remove=!0));t.globalAlpha=1,t.restore()}}function x(t=0,e=0){this.x=t,this.y=e}var d=[];function v(t,e){for(m=u.createBuffer(1,96e3,48e3),gainNode=u.createGain(),b=m.getChannelData(0),i=96e3;i--;)b[i]=getSound(t,i);s=u.createBufferSource(),s.buffer=m,s.connect(gainNode),gainNode.connect(u.destination),gainNode.gain.value=e,s.start()}function w(e){if(t=((t,e)=>(e-t)/e),e>7e4)return null;t(e,7e4);return Math.sin(.001*e*Math.sin(.009*e)+Math.sin(e/100))}function g(t){if(t>1e4)return null;var e=(1e4-t)/1e4;return(128&Math.pow(t,1.055)?1:-1)*Math.pow(e,2)}function k(t){if(t>5e4)return null;var e=(5e4-t)/5e4;return(200&Math.pow(t,.9)?1:-1)*Math.pow(e,3)}function M(t){var e=1e4;if(t>e)return null;var i=(e-t)/e,s=Math.pow(i,2.1);return Math.pow(t,3)&(t<3333.3333333333335?16:99)?s:-s}function S(t){if(t>2e4)return null;var e=(2e4-t)/2e4;return Math.sin(.003*-t*Math.sin(.09*t+Math.sin(t/200))+Math.sin(t/100))*e*e}function E(t){if(t>1e4)return null;var e=(1e4-t)/1e4;return Math.sin(.01*t*Math.sin(.009*t+Math.sin(t/200))+Math.sin(t/100))*e*e}function T(e){if(e>2e3)return null;t=((t,e)=>(e-t)/e);var i=t(e,2e3);return 33&Math.pow(50*e,.7)?i:-i}function A(e){if(t=((t,e)=>(e-t)/e),e>2e4)return null;var i=t(e,2e4);return e*=.04,Math.sin(.03*-e*Math.sin(.09*e+Math.sin(e/200))+Math.sin(e/100))*i}function R(){var t=!0;this.cam=new x,this.ratio=1,this.tips=!0,this.time=0,this.ratio=V>800?V/800:Z/600,this.scale=2,this.cube=16,this.scaled=this.scale*this.cube,this.hero=new Q(16,16,0,0,0,H.HERO,this.scale),this.introT=0,this.shake=0,this.shakeTime=0,this.reset=!1,this.wait=2,this.genLevel=function(t){this.levels=[];var e=new q(1,V,Z,this.scale);e.reset(1,this.scaled),this.levels.push(e),this.level=this.levels[0],this.hero.e.curLevel=0,this.hero.e.x=this.level.startPos[0],this.hero.e.y=this.level.startPos[1]},this.genLevel(0),this.level.objs.push(this.hero.e);this.levels[this.hero.e.curLevel].cols;this.menu=new e,this.update=function(e,i,s=!1){this.time=i,t&&(t=!1,ctx.scale(this.ratio,this.ratio)),this.shake=yt?Math.cos(it):0,this.hero.setCurrentTile(this.scaled),s||(this.level.draw(this.hero,e),this.hero.update(ctx,e),mt.canvas.style.cursor="none"),bt(ctx,.5,"#041024",V/2-125,Z-60,250,50),this.menu.ui.forEach(t=>t.update(e)),this.cam.x=X(400-this.hero.e.x-20,this.cam.x,.8),this.cam.y=X(300-this.hero.e.y-80,this.cam.y,.8)}}getSound=function(t,e){var i;switch(t){case Zt:i=w(e);break;case $t:i=M(e);break;case _t:i=g(e);break;case te:i=k(e);break;case ee:i=S(e);break;case ie:i=E(e);break;case se:i=T(e);break;case he:i=A(e);break;default:return 1}return i};const H={AIR:0,GRASS:1,HERO:2,BRDE:3,WTR:4,SEA:5,SND:6,TREE:7,RCK:8,CST:9,CNE:10,UI:11,HAM:12,SWD:13,AX:14,HP:15,HPE:16},C={FOLLOW:0,SIMPLE:1};function D(t,e,i,s,h,n,a,o,r,c){this.id=t,this.obj=null,this.up=I(o,r,colz,colz),s+=this.up,this.drop=P(o,r,colz,colz),this.e=new J(e,e,i,s,h,n,"",c,0,0),this.up>=0&&n==H.GRASS?(this.e.sx=16,this.e.sy=16):-12==this.up&&n==H.GRASS&&(this.e.sx=32,this.e.sy=16),this.column=o,this.row=r,this.active=!0,n==H.GRASS&&(this.e.y-=4),n==H.SND&&(this.e.y+=2),this.oscillationSpeed=.8,this.oscillationAmount=7,this.initialY=this.e.y,this.e.y=this.e.y+this.drop,this.update=function(t){if(this.e.y=X(this.e.y,this.initialY,.08),this.e.type==H.SEA){let t=.001*Date.now(),e=Math.sin(t*this.oscillationSpeed+this.column)*this.oscillationAmount;this.e.offsetY=0,this.e.y=this.initialY+e}this.e.update(t)},this.isTile=function(){return!0}}function P(t,e,i,s){const h=i/2,n=s/2,a=Math.min(i,s)/3,o=(t-h)*(t-h)+(e-n)*(e-n);return-(500*Math.exp(-o/(2*a*a)))}function I(t,e,i,s){const h=i/2,n=s/2,a=Math.min(i,s)/4,o=Math.min(i,s)/3,r=2*(Math.random()-.5),c=t+r,l=e+r,f=Math.sqrt((c-h)*(c-h)+(l-n)*(l-n));return f<a?-24:f<o?-12:0}function W(t,e,i,s){this.x=t,this.y=e,this.w=i,this.h=s}function L(){let t="#";for(var e=0;e<6;e++)t+="0123456789ABCDEF"[Math.floor(16*Math.random())];return t}function j(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function B(t){return new W(t.x,t.y,t.w,t.h)}function N(t,e,i,s,h,n,a,o){return t<h+a&&t+i>h&&e<n+o&&e+s>n}function O(t,e){return t.x<e.x+e.w&&t.x+t.w>e.x&&t.y<e.y+e.h&&t.y+t.h>e.y}function Y(t,e){this.x=t,this.y=e,this.set=function(t,e){this.x=t,this.y=e}}function G(t,e,i,s,h,n,a,o,r){t.save(),t.globalAlpha=r,t.translate(e,i),t.fillStyle=o,t.fillRect(s,h,n,a),t.restore()}function F(){}function U(t){var e=j(0,360)*Math.PI/180,i=j(50,180),s=[-1,1][j(0,1)]*i;return{x:t.x+s*Math.cos(e),y:t.y+s*Math.sin(e)}}function X(t,e,i){return(1-i)*t+i*e}function K(t,e){const i=Math.floor(t/2),s=Math.floor(e/2);return{x:16*(i-s)/2,y:16*(i+s)/2}}function q(t,e,i,s){ft=t,this.tiles=[],this.objs=[],this.castle=[],this.active=!1,this.startPos=[0,260],this.cols=colz,this.rotate=!1;let h=0;this.draw=function(t,e,i){this.tiles.forEach(t=>t.update(e,i)),this.objs.sort((t,e)=>t.y-e.y),this.objs.forEach(t=>t.update(e)),this.castle.forEach(t=>t.update(e)),t.e.y>290&&o(t.e.x,t.e.y,K(colz-1,colz-1))&&t.e.update(e),this.rotate&&(!function(t){let e=colz;for(let i=0;i<e;i++)for(let s=i+1;s<e;s++){let h=t.level.tiles[i*e+s],n=t.level.tiles[s*e+i];a(h,n)}for(let i=0;i<e;i++)for(let s=0;s<e/2;s++){let h=t.level.tiles[i*e+s],n=t.level.tiles[i*e+(e-s-1)];a(h,n)}}(pt),this.rotate=!1)},this.reset=function(t,e){console.log("RESET"),this.tiles=[],this.dTiles=[],h=0;let i=j(2,5),a=0,l=colz,f=0;for(r=0;r<l;r++)for(c=0;c<this.cols;c++){let t=1;r<4||c<4||c>colz-4||r>colz-4?t=H.SEA:(r<6||c<6||c>colz-6||r>colz-6)&&j(0,100)>50?t=H.SEA:(r<8||c<8||c>colz-8||r>colz-8)&&j(0,100)>20?t=H.SND:j(0,100)>99&&a<i&&(t=H.WTR,a++),xx=16*(c-r),yy=8*(c+r);var u=new D(f,16,xx,yy,0,t,!1,c,r,s);this.tiles.push(u),f++}const y=[];var p,x,d,v,m;this.tiles.forEach((t,e)=>{(function(t){return t==H.WTR})(t.e.type)&&Array.from({length:j(3,8)},(t,e)=>e).forEach(e=>{Array.from({length:j(3,5)},(t,e)=>e).forEach(i=>{let s=(d=t.row+e,v=t.column+i,m=colz,d*m+v);s=s,x=this.tiles.length,s>=0&&s<x&&y.push(s)})})}),y.forEach(t=>{j(0,100)>20&&this.tiles[t].e.type!=H.WTR&&(this.tiles[t].e.type=H.WTR,this.tiles[t].e.setType(),this.tiles[t].initialY+=6)});let w=K(colz-1,colz-1);maxTrees=10,trees=0,maxRocks=5,rocks=0,this.tiles.forEach(t=>{t.e.type==H.GRASS&&j(0,100)>98&&trees<maxTrees?o(t.e.x,t.e.y-t.drop-10-30,w)||(obj=new J(16,23,t.e.x,t.e.y-t.drop-10-30,0,H.TREE,"",s,!1,0),obj.parent=t,t.obj=obj,this.objs.push(obj),trees++):t.e.type==H.GRASS&&j(0,100)>98&&rocks<maxRocks&&(o(t.e.x,t.e.y-t.drop-10,w)||(obj=new J(16,16,t.e.x,t.e.y-t.drop-10,0,H.ROCK,"",s,!1,0),obj.parent=t,t.obj=obj,this.objs.push(obj),rocks++))}),n(this.castle,w.x+5,w.y-86,4,0,16,!0,H.CST,!0),n(this.castle,w.x-10,w.y-64,1,0,16),n(this.castle,w.x-26,w.y-56,1,0,16),n(this.castle,w.x-41,w.y-64,4,0,16,!0,H.CST,!0),n(this.castle,w.x+22,w.y-64,1,0,-16,!1),n(this.castle,w.x+38,w.y-56,1,0,-16,!1),n(this.castle,w.x+54,w.y-64,4,0,16,!0,H.CST,!0),n(this.castle,w.x+38,w.y-24,2,0,-16,!1),n(this.castle,w.x+22,w.y-18,2,0,-16,!1),n(this.castle,w.x-26,w.y-8,3,0,-16,!1),n(this.castle,w.x-10,w.y,3,0,-16,!1),n(this.castle,w.x+6,w.y-40,4,0,16,!0,H.CST,!0)};const n=(t,e,i,h,n=0,a=8,o=!0,r=H.CST,c=!1)=>{const l=o?t=>t>=0:t=>t<h,f=o?t=>--t:t=>++t;for(let c=o?h-1:0;l(c);c=f(c))t.push(new J(16,16,e+n*c,i+a*c,0,r,"",s,!1,0));c&&t.push(new J(16,16,e+n,i+a-20,0,H.CNE,"",s,!1,0))};function a(t,e){let i=t.e.type;t.e.type=e.e.type,e.e.type=i,t.e.setType(),e.e.setType()}function o(t,e,i){const s=[-90,i.y-100],h=[90,i.y+20];return t>=s[0]&&t<=h[0]&&e>=s[1]&&e<=h[1]}}function J(t,e,i,h,n,a,o,r,c=!1,l=0){this.scale=r,this.type=a,this.width=t,this.height=e,this.mhWidth=t/-2,this.mhHeight=e/-2,this.mhWScld=t/-2*r,this.mhHScld=e/-2*r,this.hWidth=t/2,this.hHeight=e/2,this.cenX=i-this.mhWScld,this.cenY=h-this.mhHScld,this.angle=n,this.x=i,this.y=h,this.z=0,this.active=!0,this.colour=o,this.image=ut,this.animated=!1,this.alpha=1,this.currentTile=0,this.colArr=[],this.isSolid=!1,this.isButton=c,this.time=0,this.maxHP=l,this.hp=this.maxHP,this.flip=!1,this.idle=0,this.chk=!1,this.offsetY=0,this.parent=null,this.wet=!1,this.ui=!1,this.sx=0,this.sy=0,this.setHitbox=function(){this.hb=new W(0,0,0,0),this.sensor=new W(0,0,0,0),this.isButton&&(this.hb.w=2*this.width,this.hb.h=2*this.height)},this.setHitbox(),this.updateHitbox=function(){this.isButton?(this.hb.x=this.x-this.width,this.hb.y=this.y-this.height):(this.hb.x=this.x+this.scale/2,this.hb.y=this.y+this.scale/2,this.hb.w=this.width*this.scale-this.scale,this.hb.h=this.height*this.scale-this.scale,this.sensor.x=this.x-5,this.sensor.y=this.y-5,this.sensor.w=this.width*this.scale+10,this.sensor.h=this.height*this.scale+10)},this.update=function(i){if(this.idle+=i,this.updateHitbox(),this.active){if(ctx.save(),ctx.translate(this.x,this.y-this.z),ctx.globalAlpha=this.alpha,img=this.image,s=this.scale,mhw=this.mhWidth,mhh=this.mhHeight,hw=this.hWidth,hh=this.hHeight,t=this.width,e=this.height,pt.shakeTime>0&&(pt.shakeTime-=i/1e3,ctx.translate(pt.shake,pt.shake)),this.ui)ctx.setTransform(1,0,0,1,0,0),this.flip&&(ctx.scale(-1,1),ctx.translate(-t*s,0)),ctx.drawImage(img,this.sx,this.sy,t,e,this.x,this.y,t*s,e*s);else if(ctx.translate(pt.cam.x,pt.cam.y),null==this.image)ctx.fillStyle=this.colour,ctx.fillRect(.5*mhw*s,.5*mhh*s,.5*t*s,.5*e*s);else{if(this.flip?(ctx.scale(-1,1),ctx.translate(-t*s-t,0)):ctx.scale(1,1),f=0,z=0,this.angle>0){let t=24;ctx.translate(t,t),ctx.rotate(this.angle*Math.PI/180),ctx.translate(-t,-t)}this.wet&&(e-=2),ctx.drawImage(img,this.sx,this.sy,t,e,hw+z,hh+f,t*s,e*s)}ctx.restore()}this.cenX=this.x-this.mhWScld,this.cenY=this.y-this.mhHScld},this.isHero=function(){return this.type==H.HERO},this.isTile=function(){return!1},this.setT=function(t){this.type=t,this.setType()},this.setType=function(){switch(this.alpha=1,this.sy=0,this.sx=0,this.isSolid=!1,this.type){case H.HERO:this.isSolid=!0,this.sx=0,this.sy=0;break;case H.GRASS:this.sx=16;break;case H.BRDE:this.sx=32;break;case H.WTR:case H.SEA:this.sx=48;break;case H.AIR:this.sx=144;break;case H.SND:this.sy=16;break;case H.TREE:this.isSolid=!0,this.sx=80;break;case H.ROCK:this.isSolid=!0,this.sx=64;break;case H.CST:this.isSolid=!0,this.sx=64,this.sy=16;break;case H.CNE:this.sx=48,this.sy=16;break;case H.UI:this.ui=!0,this.sy=32;break;case H.HAM:this.sx=16,this.sy=33,this.ui=!0;break;case H.SWD:this.sx=26,this.sy=33,this.ui=!0;break;case H.AX:this.sx=36,this.sy=32,this.ui=!0;break;case H.HP:this.sx=48,this.sy=32,this.ui=!0;break;case H.HPE:this.sx=64,this.sy=32,this.ui=!0}},this.setType()}function Q(t,e,i,s,h,n,a){this.e=new J(t,e,i,s,h,n,"",a,!1,100),this.e.z=24,this.active=!0,this.hp=2,this.particles=[];let o=null,r=null,c=0,l=0,f=(this.e.x,this.e.y,0),u=0,y=0,p=0;this.deaths=0,this.done=!1,this.changeLevel=!1,this.moved=!1,this.weapon=0,this.update=function(t,e){this.time+=e,c+=e,this.moved=!1,this.active&&(Mt()||St()||Et()||Tt()?f+=e:(l=0,f=0),Et()&&(this.e.y-=this.gMove(0,-1),this.moved=!0),Tt()&&(this.e.y+=this.gMove(0,1),this.moved=!0),Mt()&&(this.e.x-=this.gMove(-1,0),this.e.flip=!0,this.moved=!0),St()&&(this.e.x+=this.gMove(1,0),this.e.flip=!1,this.moved=!0),Ht()&&1!=this.weapon&&(this.weapon=1),Ct()&&2!=this.weapon&&(this.weapon=2),Dt()&&3!=this.weapon&&(this.weapon=3)),(Et()||At()||Ht()||St()||Mt())&&(c=0);for(let i=0;i<=this.particles.length-1;i++)this.particles[i].update(t,e);f>.35&&this.addDust(),y=this.e.x-this.e.mhWScld,p=this.e.y-this.e.mhHScld},this.reset=function(){this.done=!1,this.particles=[],this.hp=2;let t=pt.levels[this.e.curLevel];this.e.x=t.startPos[0],this.e.y=t.startPos[1]},this.kill=function(){this.active&&(this.deaths++,pt.shakeTime=.15,v(ie,1),this.hp--,this.active=!1,u=.5,l=0,this.e.sy=16,0==this.hp&&this.hp++)},this.setCurrentTile=function(t){if(this.moved){r=o;const e=this.e.x/t,i=(this.e.y+2*this.e.height+this.e.z)/t*2,s=i-e,h=e+i;heroRow=Math.floor(s),heroCol=Math.floor(h),heroTileIndex=heroCol+pt.levels[this.e.curLevel].cols*heroRow,(o=pt.level.tiles[heroTileIndex])&&r&&o.id!==r.id&&r.up!==o.up&&(this.e.z=.25*-o.up)}null!=o&&(o.e.type==H.WTR?(l=1,this.e.wet=!0):o.e.type==H.SEA?(l=.25,this.e.wet=!0):(l=3,this.e.wet=!1))},this.addDust=function(t=!1){f=0},this.jump=function(){},this.gMove=function(t,e,i=!1,s=!1){this.e.idle=0,rec=B(this.e.hb),rec.w=20,rec.h=10,rec.x+=t*l,rec.y+=e*l,canMove=!0;for(var h=0;h<pt.level.objs.length;h++)if(obj=pt.level.objs[h],null!=obj&&O(obj.hb,rec)&&2!=obj.type&&obj.isSolid){canMove=!1;break}return canMove?l:0}}colz=40;let V=window.innerWidth,Z=window.innerHeight,$=!1,_=0,tt=Date.now(),et=Date.now(),it=0,st=0,ht=new Y(0,0),nt=new Y(0,0),at=!1,ot=!1,rt=!1,ct="990099",lt=!1,ft=1,ut=new Image;ut.src="atlas.png";let yt=!0,pt=new R,xt=!1,dt=!0,vt=!1;function startGame(){mt.start()}y();let mt={canvas:document.createElement("canvas"),start:function(){this.canvas.width=V,this.canvas.height=Z,this.context=this.canvas.getContext("2d"),this.context.scale(1,1),ctx=this.context,ctx.mozImageSmoothingEnabled=!1,ctx.webkitImageSmoothingEnabled=!1,ctx.imageSmoothingEnabled=!1,this.canvas.classList.add("screen"),document.body.insertBefore(this.canvas,document.body.childNodes[6]),this.frameNo=0,this.interval=setInterval(wt,20),window.addEventListener("keydown",function(t){xt=!0,t.preventDefault(),mt.keys=mt.keys||[],mt.keys[t.keyCode]="keydown"==t.type}),window.addEventListener("keyup",function(t){mt.keys[t.keyCode]="keydown"==t.type,t.keyCode==Qt&&(rt=!0),t.keyCode==Ot&&(vt=!vt),t.keyCode==Vt&&(pt.tips=!pt.tips)}),this.canvas.oncontextmenu=function(t){t.preventDefault()}},stop:function(){clearInterval(this.interval)},clear:function(){this.context.clearRect(0,0,4*this.canvas.width,4*this.canvas.height)}};function wt(){if(ot&&(it=0,ot=!1,lt=!1,ft=0,xt=!1,$=!1,pt.genLevel(ft)),xt&&(null!=pt.hero&&(pt.hero.e.active=!0),$=!0,null==u&&(u=new AudioContext)),tt=et,et=Date.now(),it+=_=et-tt,$){mt.clear(),pt.update(_,it,!1);let t="15px Papyrus";kt(ctx,1,t,"WHITE","[M] Music: "+!vt,650,20),kt(ctx,1,t,"WHITE","[T] Tips: "+pt.tips,650,40),kt(ctx,1,t,"WHITE","[R] Reset Level",650,60),kt(ctx,1,t,"WHITE","Lives: "+pt.hero.hp,10,80),kt(ctx,1,t,"RED","Deaths: "+pt.hero.deaths,10,100),kt(ctx,1,t,"WHITE","Level: "+(pt.hero.e.curLevel+1),10,60),kt(ctx,1,t,"WHITE","X: "+pt.hero.e.x,10,120),kt(ctx,1,t,"WHITE","Y: "+pt.hero.e.y,10,140);pt.hero.e.curLevel;vt&&(h.pause(),dt=!0),dt&&n&&!vt&&(h.play(),h.loop=!0,dt=!1)}else{mt.clear(),ctx=mt.context,pt.update(_,it,!0),ctx.save(),bt(ctx,.1,"#"+ct,0,0,V,Z),kt(ctx,1,"18px Papyrus","WHITE","Main Screen",22,25),ctx.restore()}}function bt(t,e,i,s,h,n,a){t.save(),t.setTransform(1,0,0,1,0,0),t.globalAlpha=e,t.fillStyle=i,t.fillRect(s,h,n,a),t.restore()}function gt(t,e,i,s,h,n,a){var o=eval('"\\u'+h+'"');t.globalAlpha=e,t.font=i,t.fillStyle=s,t.fillText(o,n,a)}function kt(t,e,i,s,h,n,a){t.globalAlpha=e,t.font=i,t.fillStyle=s,t.fillText(h,n,a)}function Mt(){return mt.keys&&(mt.keys[Pt]||mt.keys[jt])}function St(){return mt.keys&&(mt.keys[It]||mt.keys[Nt])}function Et(){return mt.keys&&(mt.keys[Wt]||mt.keys[Lt])}function Tt(){return mt.keys&&(mt.keys[zt]||mt.keys[Bt])}function At(){return mt.keys&&mt.keys[Ft]}function Rt(){return mt.keys&&mt.keys[Ot]}function Ht(){return mt.keys&&(mt.keys[Xt]||mt.keys[Ut])}function Ct(){return mt.keys&&mt.keys[Kt]}function Dt(){return mt.keys&&mt.keys[qt]}var Pt=37,It=39,Wt=38,zt=40,Lt=87,jt=65,Bt=83,Nt=68,Ot=77,Yt=0,Gt=2,Ft=32,Ut=69,Xt=49,Kt=50,qt=51,Jt=52,Qt=82,Vt=84,Zt=0,$t=1,_t=2,te=3,ee=4,ie=5,se=6,he=7;